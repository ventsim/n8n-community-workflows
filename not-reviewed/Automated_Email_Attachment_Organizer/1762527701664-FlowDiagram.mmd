flowchart TD
    A[ğŸ“§ Gmail Trigger<br/>Poll emails with Label_2] --> B{ğŸ” Whitelist Check<br/>Verify sender in Google Sheets}
    B -->|Approved| C{ğŸ¢ Company Folder<br/>Check if exists}
    B -->|Rejected| Z[âŒ Workflow Ends]
    C -->|Not Found| D[ğŸ“ Create Company Folder]
    C -->|Found| E[ğŸ“… Year/Month Logic<br/>Generate folder structure]
    D --> E
    E --> F{ğŸ“‚ Month Folder<br/>Check if exists}
    F -->|Not Found| G[ğŸ“ Create Month Folder]
    F -->|Found| H[ğŸ“§ Download Email<br/>With Attachments]
    G --> H
    H --> I[ğŸ”§ Split Attachments<br/>Process multiple files]
    I --> J[ğŸ”„ Loop Items<br/>Batch process files]
    J --> K[ğŸ“¤ Upload to Drive<br/>With timestamp prefix]
    style A fill:#4285F4,color:white
    style B fill:#34A853,color:white
    style C fill:#FBBC05,color:white
    style D fill:#EA4335,color:white
    style E fill:#4285F4,color:white
    style F fill:#34A853,color:white
    style G fill:#EA4335,color:white
    style H fill:#FBBC05,color:white
    style I fill:#4285F4,color:white
    style J fill:#34A853,color:white
    style K fill:#EA4335,color:white
    style Z fill:#666666,color:white