flowchart TD
    A[ğŸ“¥ Gmail Trigger<br/>Monitor Label_2 Emails] --> B[ğŸ“‹ Whitelist Validation<br/>Check Sender Against Google Sheets]
    B --> C{â“ Company Folder Exists?}
    C -->|No| D[ğŸ“ Create Company Folder<br/>Google Drive]
    C -->|Yes| E[ğŸ“… Format Year/Month<br/>From Email Date]
    D --> E
    E --> F{â“ Year/Month Folder Exists?}
    F -->|No| G[ğŸ“‚ Create Year/Month Folder<br/>Google Drive]
    F -->|Yes| H[ğŸ“§ Retrieve Full Email<br/>With Attachments]
    G --> H
    H --> I[ğŸ”§ Split Binary Data<br/>Separate Attachments]
    I --> J[ğŸ”„ Process Attachments<br/>Batch Loop]
    J --> K[ğŸ“¤ Upload Files<br/>With Timestamp Prefix]
    
    style A fill:#4285F4,color:white
    style B fill:#34A853,color:white
    style C fill:#FBBC05,color:black
    style D fill:#EA4335,color:white
    style E fill:#4285F4,color:white
    style F fill:#FBBC05,color:black
    style G fill:#EA4335,color:white
    style H fill:#4285F4,color:white
    style I fill:#34A853,color:white
    style J fill:#FBBC05,color:black
    style K fill:#EA4335,color:white